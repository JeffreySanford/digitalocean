<!DOCTYPE html>
<html>
  <head>
    <meta charset=utf-8 />
    <title>Ruck It</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
    <link href="css/style.css" rel="stylesheet" />
  </head>
  <body>
    <div id="map-container">
      <div id='map' style="">
        <input id='range' class='range' type='range' min='0' max='1.0' step='any' />
        <div id="status" style="" >
          <div id="info"></div>
        </div>
      </div>
    </div>
    <div id="information" style="">
      <h3>Information</h3>
      <span><p>latitude: <span id='latitude' style=''></p></span>
      <span><p>longitude: <span id='longitude'></p></span>
    </div>
    <div id="controls">Controls

<style>
    #fly {
        display: block;
        position: relative;
        margin: 0px auto;
        width: 50%;
        height: 40px;
        padding: 10px;
        border: none;
        border-radius: 3px;
        font-size: 12px;
        text-align: center;
        color: #fff;
        background: #ee8a65;
    }
</style>
<div id='map'></div>
<br/>
<button id='fly'>Fly</button>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiamVmZnJleXNhbmZvcmQiLCJhIjoiY2lyNnFja2R0MDA3eWc3bTM5eTNleGdweSJ9.AC5sw0L2S3GZMCbUWvrJ-g';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v9',
    center: [-74.50, 40],
    zoom: 9
});

document.getElementById('fly').addEventListener('click', function () {
    // Fly to a random location by offsetting the point -74.50, 40
    // by up to 5 degrees.
    map.flyTo({
        center: [
            -74.50 + (Math.random() - 0.5) * 10,
            40 + (Math.random() - 0.5) * 10]
    });
});
</script>


      <p>Current location {{current_location}}
      <p>Waypoint A {{waypoint.geo-location}}</p>
      <p>Waypoint B {{waypoint.geo-location}}</p>
      <p>Waypoint C {{waypoint.geo-location}}</p>
      <div id="compass">
        <script src="https://code.jquery.com/jquery-3.1.0.js" integrity="sha256-slogkvB1K3VOkzAI8QITxV3VzpOnkeNVsKvtkYLMjfk=" crossorigin="anonymous"></script>
        <script src="https://ai.github.io/compass.js/compass.js">
        Compass.init(function (method) {
          console.log('Compass heading by ' + method);
          });
        </script>

        <script>
          // Hide compass for desktop users (without compass, GPS and accelerometers):

          function compassHeading(alpha, beta, gamma) {

            // Convert degrees to radians
            var alphaRad = alpha * (Math.PI / 180);
            var betaRad = beta * (Math.PI / 180);
            var gammaRad = gamma * (Math.PI / 180);

            // Calculate equation components
            var cA = Math.cos(alphaRad);
            var sA = Math.sin(alphaRad);
            var cB = Math.cos(betaRad);
            var sB = Math.sin(betaRad);
            var cG = Math.cos(gammaRad);
            var sG = Math.sin(gammaRad);

            // Calculate A, B, C rotation components
            var rA = - cA * sG - sA * sB * cG;
            var rB = - sA * sG + cA * sB * cG;
            var rC = - cB * cG;

            // Calculate compass heading
            var compassHeading = Math.atan(rA / rB);

            // Convert from half unit circle to whole unit circle
            if(rB < 0) {
              compassHeading += Math.PI;
            }else if(rA < 0) {
              compassHeading += 2 * Math.PI;
            }

            // Convert radians to degrees
            compassHeading *= 180 / Math.PI;

            return compassHeading;

          }
          window.addEventListener('deviceorientation', function(evt) {

            var heading = null;

            if(evt.absolute === true && evt.alpha !== null) {
              heading = compassHeading(evt.alpha, evt.beta, evt.gamma);
              console.log(heading);
            }

            // Do something with 'heading'...

          }, false);

          Compass.noSupport(function () {
            $('.compass').hide();
          });

          // Show instructions for Android users:

          Compass.needGPS(function () {
            $('.go-outside-message').show();          // Step 1: we need GPS signal
            }).needMove(function () {
            $('.go-outside-message').hide()
            $('.move-and-hold-ahead-message').show(); // Step 2: user must go forward
            }).init(function () {
          $('.move-and-hold-ahead-message').hide(); // GPS hack is enabled
          });

          //Add compass heading listener:

          Compass.watch(function (heading) {
            $('.degrees').text(heading);
            $('.compass').css('transform', 'rotate(' + (-heading) + 'deg)');
          });
        </script>

      </div>
      <script src="mapbox-definition.js"></script>

    </div>
  </body>
</html>
